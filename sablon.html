{% if items and order %}

	{{ items|json_script:"items-json" }}
	{{ order|json_script:"order-json" }}

	<div id="products"></div>

	<style>
		/* Alap */
		body {
			font-size: 10px;
			color: black;
		}

		/* Listák */
		ol,
		ul {
			margin: 0 0 1rem;
			padding-left: 1.75em;
		}
		ol { list-style: decimal; }
		ol > li {
			margin: 0.35rem 0;
			line-height: 1.45;
			font-variant-numeric: tabular-nums;
		}
		ul { list-style: none; }
		ul > li {
			margin: 0.35rem 0;
			list-style-type: circle;
		}

		/* Oldalankénti blokkok */
		.product-warranty {
			padding: 0;
			margin: 0;
		}
		.product-warranty:not(:last-of-type) {
			page-break-after: always;
		}

		/* Szövegtömbök */
		.text-block { padding-bottom: 1em; }
		.text-block p {
			line-height: 1.5em;
			margin-top: 0.5em;
		}

		/* Rendelés blokk */
		.order { margin-top: 1em; }

		/* Termék adatok konténer */
		.product-slot {
			margin-top: 1em;
			padding-top: 1em;
			border-top: 1px solid gray;
		}

		/* Sorok és címkék */
		.row {
			margin: 2px 0;
			font-size: 12px;
			line-height: 1.35;
		}
		.label {
			font-weight: bold;
			display: inline-block;
			width: 180px;
			vertical-align: top;
		}

		/* Csomag összetevők */
		.components {
			margin-top: 6px;
			padding-top: 6px;
		}
		/* Töréspontok megelőzése több helyen egyben */
		.component,
		.in-case-of-repair,
		.in-case-of-replace,
		.repair-form {
			break-inside: avoid;
			page-break-inside: avoid;
		}
		.component {
			margin: 6px 0 0;
			padding: 6px 8px;
			border: 1px dotted gray;
		}

		/* Sablon elrejtése */
		#warranty-template { display: none; }

		/* Fix szöveg blokk */
		.warranty-terms { margin-top: 25px; }

		/* Cég fejléc */
		.pdf_fejlec_ceg {
			border: 1px solid black;
			display: inline-block;
			width: 49%;
			padding: 20px;
			box-sizing: border-box;
		}

		/* Címsorok */
		h1 {
			font-size: 2.2em;
			font-weight: bold;
			margin: 0.5em 0 0.4em;
			color: black;
			letter-spacing: 0.02em;
			text-align: center;
		}
		h2 {
			font-size: 1.5em;
			font-weight: bold;
			margin: 1.2em 0 0.5em;
			color: black;
			border-bottom: 2px solid gray;
			padding-bottom: 2px;
		}
		h3 {
			font-size: 1.15em;
			font-weight: bold;
			margin: 1em 0 0.4em;
			color: #444;
		}

		/* Javítás / csere blokkok */
		.in-case-of-repair { margin-top: 2em; }

		/* Űrlapblokkok */
		.repair-form {
			margin: 20px 5px 0 0;
			width: 49%;
			display: inline-block;
			box-sizing: border-box;
		}
		.repair-form td {
			border: 1px solid gray;
			vertical-align: top;
			height: 7mm;
			padding: 5px 0 0 10px;
		}
		.repair-form td.multiline { height: 1.5cm; }

		/* Szervizpontok */
		.service-locations {
			width: 100%;
			margin-top: 1em;
		}
		.service-location {
			padding: 20px;
			margin: 1em 4% 0 0;
			width: 45%;
			display: inline-block;
			border: 1px solid gray;
			box-sizing: border-box;
		}
	</style>

	<!-- Jótállás sablon (MINTA, rejtve). Ezt klónozzuk minden termékre. -->
	<div id="warranty-template" class="product-warranty">

		<header>
			<svg height="1cm" viewBox="0 0 540 103" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M149.406 4.29865L146.013 28.1309L159.857 28.0842L148.696 101.299L174.743 101.214L185.246 27.8291L199.919 27.7823L203.312 4.12007L149.406 4.29865ZM112.681 1.16921C91.1962 -2.75961 73.5506 13.6828 66.0586 40.8741C58.3668 68.7798 63.9751 96.0179 86.8975 101.112C106.478 105.453 127.767 85.962 133.954 57.8522C139.86 31.0478 132.415 4.77487 112.681 1.16921ZM108.472 55.756C105.215 70.1446 98.6372 79.3374 93.3902 76.4333C87.2461 73.036 86.9315 58.9535 90.5967 44.7136C94.1641 30.8437 99.7809 23.3517 105.581 26.09C110.913 28.6114 111.576 42.0391 108.472 55.756ZM0 101.256L25.3885 101.171L30.8863 63.9623L48.5235 63.9028L52.0824 41.2695L34.4452 41.3376L36.3841 27.102L55.671 27.0467L58.9025 4.24338L14.2228 4.55377L0 101.256ZM339.337 8.65692C328.941 3.72039 316.249 4.96196 312.29 4.97472C308.336 4.99172 293.496 5.20432 293.496 5.20432L279.269 101.575L304.658 101.494L309.016 70.1149C309.016 70.1149 329.63 72.2154 338.674 62.5846C347.709 52.9582 349.359 51.7549 350.634 37.1791C351.901 22.6119 349.733 13.5935 339.337 8.65692ZM325.556 33.667C325.339 35.725 324.808 39.6113 322.941 41.4481C321.079 43.285 319.552 46.1423 312.737 45.8191L316.308 23.9895C316.308 23.9895 322.571 23.6239 324.013 26.9319C325.446 30.2399 325.773 31.6176 325.556 33.667ZM523.141 25.1631C527.316 25.8349 532.61 28.7942 535.697 35.1765C536.768 25.5798 540 5.45944 540 5.45944C540 5.45944 524.144 -3.40166 512.294 2.80621C500.444 9.00984 496.94 12.2243 491.914 24.8059C486.897 37.3917 488.9 46.2954 492.654 51.538C496.409 56.7765 507.642 65.4335 507.651 69.5409C507.668 73.6525 504.828 79.3757 497.119 77.339C489.419 75.3023 484.788 66.6368 484.788 66.6368L480.264 97.2722C480.264 97.2722 488.411 103.416 502.919 100.852C517.418 98.2927 528.596 87.0632 531.419 75.855C534.251 64.6511 537.304 57.3335 526.721 45.0198C520.76 37.9572 514.824 35.4613 515.47 31.1158C516.117 26.7831 518.966 24.4913 523.141 25.1631ZM457.193 2.81472C457.193 2.81472 448.298 64.0218 447.817 68.1377C447.345 72.2579 445.649 75.685 443.663 76.1994C441.682 76.7182 437.906 77.9853 436.465 75.1365C435.027 72.2834 434.913 70.1106 435.453 66.2243C435.984 62.338 445.045 2.67015 445.045 2.67015L419.274 2.75094C419.274 2.75094 410.213 63.6179 409.252 71.1694C408.278 78.7124 409.643 90.0226 416.085 94.6275C422.522 99.2409 424.848 101.626 436.873 101.596C448.91 101.55 455.662 99.3046 462.402 91.9147C469.132 84.5291 470.774 81.085 472.402 71.4925C474.022 61.8831 483.083 2.67015 483.083 2.67015L457.193 2.81472ZM391.258 4.89818L365.699 4.80889L351.634 101.516L395.654 101.375L398.89 78.3977L380.088 78.4615L391.258 4.89818ZM252.261 0.727C230.78 -3.20182 213.13 13.2363 205.642 40.4276C197.946 68.3376 203.559 95.5799 226.477 100.661C246.057 105.002 267.347 85.5198 273.542 57.41C279.444 30.6013 271.994 4.33692 252.261 0.727ZM248.047 55.318C244.79 69.7109 238.212 78.9037 232.97 75.9954C226.826 72.6065 226.511 58.5155 230.176 44.2799C233.748 30.41 239.36 22.9138 245.164 25.652C250.492 28.1692 251.155 41.5927 248.047 55.318Z" fill="black"/>
			</svg>

		</header>

		<div class="text-block">
			<h1>Jótállási jegy</h1>

			<p>
				Tisztelt Fogyasztó!
			</p>

			<p>
				Örömünkre szolgál, hogy az általunk forgalmazott terméket választotta, bízunk benne, hogy elégedett lesz. A termékre, mint hivatalos importőr és forgalmazó (Fotoplus Kft., székhely: 7623 Pécs, Megyeri út 59., telefonszám: +36 (72) 516 906, e-mail: fotoplus@fotoplus.hu), fogyasztói szerződés keretében történő vásárlásokra
				<ul>
					<li><strong>két év</strong> (a 10.000 Ft-ot meghaladó, de 250.000.-Ft-ot meg nem haladó eladási ár esetén)
					<li><strong>három év</strong> (a 250.000 Ft eladási ár felett)
				</ul>
				jótállást biztosítunk. Bővebb információk a „Jótállás feltételei” részben olvashatóak.
			</p>
		</div>
		<!-- Cég adatok -->

		<!--div class="pdf_fejlec_ceg">
			{% pdf_fejlec_ceg_nev %}
			{% pdf_fejlec_ceg_adoszam %}
			{% pdf_fejlec_ceg_cim %}
			{% pdf_fejlec_ceg_email %}
			{% pdf_fejlec_ceg_telefonszam %}
			{% pdf_fejlec_ceg_weboldal %}
		</div-->



		<!-- Vevő/Rendelés adatok -->
		<div class="order">
			<div class="row">
				<span class="label">Megrendelés azonosító:</span> 
				<span>{{ order.order_identifier|default_if_none:'' }}</span>
			</div>
			<div class="row">
				<span class="label">Számla száma:</span> 
				<span>{{ order.invoice_id|default_if_none:'' }}</span>
			</div>
			<div class="row">
				<span class="label">Számla kiállításának ideje:</span> 
				<span>{{ order.invoice_created_timestamp|default_if_none:'' }}</span>
			</div>

			<div class="row">
				<span class="label">Megrendelés ideje:</span> 
				<span>{{ order.real_created_date|_datum }}</span>
			</div>

			<div class="row">
				<span class="label">Fogyasztónak átadás ideje:</span> 
				<span>{{ order.completed_timestamp|_datum }}</span>
			</div>
		</div>

		<!-- Termék adatainak helye: IDE fogunk írni JS-ből -->
		<div class="product-slot"></div>


		<!-- Fix jótállási szöveg -->
		<div class="warranty-terms text-block">

			<h2>Jótállási feltételek</h2>
			<h3>Általános tudnivalók</h3>
			<ol>
				<li>A fogyasztó jótállási igényét a jótállási jeggyel érvényesítheti, ezért kérjük, azt jól őrizze meg. Elveszett, károsodott jótállási jegyet a kereskedőnek nem áll módjában pótolni. A jótállási jegy szabálytalan vagy hiányos kiállítása vagy a jótállási jegy fogyasztó rendelkezésére bocsátásának elmaradása a jótállás érvényességét nem érinti (ebben az esetben a fogyasztó a vásárlást igazoló bizonylat (nyugta, számla) bemutatásával érvényesítheti igényét).</li>
				<li>Hiányosan kitöltött jótállási jegyet nem áll módunkban elfogadni.</li>
				<li>A jótállási jegyen történt bármilyen javítás, törlés vagy átírás, valótlan adatok bejegyzése, a jótállási jegy érvénytelenségét vonja maga után.</li>
				<li>Érvénytelen jótállási jegy a jótállás érvényességét nem érinti (ebben az esetben a fogyasztó a vásárlást igazoló bizonylat (nyugta, számla) bemutatásával érvényesítheti igényét).</li>
				<li>A jótállás kezdete a vásárlás (üzembe helyezés) napja, amit a jótállási jegyen fel kell tüntetni.</li>
				<li>A jótállásból eredő jogok érvényesítésének nem feltétele a fogyasztási cikk eredeti csomagolás fogyasztó általi visszaszolgáltatása.</li>
				<li>A fenti határidők elmulasztása jogvesztéssel jár. A termék kijavítása esetén a jótállás határideje a hiba közlésének napjától a kijavítás napjáig eltelt idővel meghosszabbodik (ameddig a hiba a termék rendeltetésszerű használatát akadályozta).</li>
			</ol>
			<h3>A vásárlót a jótállás alapján megillető jogok</h3>
			<p>A vásárló a 151/2003. (IX. 22.) kormányrendeletben meghatározott jótállás esetében a Polgári Törvénykönyvről szóló 2013. évi V. törvény („Ptk.”) 6:171-173. §, valamint a 19/2014. (IV-29.) NGM rendeletben megállapított jogok illetik meg.</p>
			<ol>
				<li>A vásárló kijavítást vagy kicserélést igényelhet, kivéve, ha a választott kellékszavatossági jog teljesítése lehetetlen, vagy ha az a kötelezettnek másik jótállási igény teljesítésével összehasonlítva aránytalan többletköltséget eredményezne, figyelembe véve a termék hibátlan állapotban képviselt értékét, a szerződésszegés súlyát és a kellékszavatossági jog teljesítésével a jogosultnak okozott érdeksérelmet.</li>
				<li>A kötelezettnek törekednie kell arra, hogy a kijavítást tizenöt napon belül elvégezze. Ha a kijavítás vagy a kicserélés a tizenöt napot meghaladja, akkor a kötelezett a vásárlót köteles a kijavítás vagy kicserélés várható időtartamáról tájékoztatni. A tájékoztatás a fogyasztó előzetes hozzájárulása esetén elektronikus úton, vagy más, a fogyasztó általi átvétel igazolására alkalmas módon történik.</li>
				<li>A vásárló az ellenszolgáltatás (vételár) arányos leszállítását is igényelheti, a hibát a kötelezett költségére maga is kijavíttathatja, vagy a szerződéstől elállhat, amennyiben a kötelezett a kijavítást vagy kicserélést nem vállalta a fenti bekezdésben foglalt határidőn belül, a jogosult érdekeit kímélve nem tud eleget tenni, vagy ha a vásárlónak a kijavításhoz vagy a kicseréléshez az érdeke megszűnt. Jelentéktelen hiba miatt elállásnak nincs helye.</li>
				<li>A jótállási időtartam alatt a fogyasztási cikk első alkalommal történő javítása során megbizonyosodik, hogy a fogyasztási cikk nem javítható, a fogyasztó eltérő rendelkezése hiányában a vállalkozás köteles a fogyasztási cikket nyolc napon belül kicserélni. Ha a fogyasztási cikk cseréjére nincs lehetőség, a vállalkozás köteles a fogyasztó által bemutatott, a fogyasztási cikk ellenértékének megfizetését igazoló bizonylaton (nyugta vagy számla) szereplő vételárat nyolc napon belül a fogyasztó részére visszatéríteni.</li>
				<li>Ha a jótállási időtartam alatt a fogyasztási cikk három alkalommal történő kijavítását követően ismételten meghibásodik, a fogyasztó eltérő rendelkezése hiányában, valamint a Ptk. 2013. évi törvény 6:159 § (2) bekezdés B) pontja alapján a fogyasztó nem igényli a vételár arányos leszállítását, és a fogyasztó nem kívánja a fogyasztási cikket a vállalkozás költségére kijavítani vagy mással kijavíttatni, a vállalkozás köteles a fogyasztó által bemutatott, a vállalkozás köteles a fogyasztási cikket nyolc napon belül kicserélni. Ha a fogyasztási cikk kicserélésére nincs lehetőség, a vállalkozás köteles a fogyasztó által bemutatott, a fogyasztási cikk ellenértékének megfizetését igazoló bizonylaton (nyugta vagy számla) szereplő vételárat nyolc napon belül fogyasztó részére visszatéríteni.</li>
				<li>Ha a fogyasztási cikk kijavításra a kijavítási igény vállalkozás részére való közlésétől számított harmincadik napig nem kerül sor, a fogyasztó eltérő rendelkezése hiányában, a vállalkozás köteles a fogyasztási cikket a harmincnapos határidő eredménytelen elteltét követő nyolc napon belül kicserélni. Ha a fogyasztási cikk kicserélésére nincs lehetőség, a vállalkozás köteles a fogyasztó által bemutatott, a fogyasztási cikk ellenértékének megfizetését igazoló bizonylaton (nyugta vagy számla) szereplő vételárat nyolc napon belül fogyasztó részére visszatéríteni.</li>
				<li>A kijavítás során a fogyasztási cikkbe csak új alkatrész kerülhet beépítésre.</li>
				<li>Ha a fogyasztási cikk vásárlástól számított három munkanapon belül hibásodik meg, a vállalkozás azt azonos típusú új termékre cseréli, feltéve, hogy a hiba a rendeltetésszerű használatot akadályozza.</li>
			</ol>

			<h3>A jótállási kötelezettség kizárása</h3>
			<ol>
				<li>A jótállási kötelezettség nem áll fenn, ha a hiba bizonyíthatóan nem rendeltetésszerű használat, átalakítás, szakszerűtlen kezelés, helytelen tárolás, elemi kár, vagy egyéb, a vásárlást követően keletkezett okból következett be.</li>
				<li>A jótállási időn belül bekövetkezett meghibásodásokat a Fotoplus Kft. vagy az általa kijelölt szakszerviz jogosult megjavítani, idegen beavatkozás kizárja a jótállási kötelezettségünket.</li>
				<li>A jótállási felelősségünk kizárt, amennyiben nem eredeti tartozékokat és kiegészítőket használt, valamint ha a készülék gyári számát eltávolították vagy megrongálták.</li>
				<li>Céltávcsövek esetében a kiterjesztett jótállás csak akkor biztosítható, ha a felszerelést és beállítást igazoltan fegyvermester végezte el.</li>
			</ol>
			<h3>További tudnivalók</h3>
			<p>Nem tartoznak a jótállás körébe a természetes módon, üzemszerűen elhasználódó alkatrészek, például hordszíj, hordtáska, elemek, akkumulátorok, stb., illetve a burkolat rendeltetésszerű használat mellett bekövetkező kopása, karcolódása.A jótállás nem érinti a vásárló jogszabályból eredő – így különösen kellék- és termékszavatossági, illetve kártérítési – jogainak érvényesítési lehetőségeit.</p>
			<p>Fogyasztói jogvita esetén a fogyasztó a megyei (fővárosi) kereskedelmi és iparkamarák mellett működő békéltető testület eljárását is kezdeményezheti.</p>
		</div>


		<div class="in-case-of-repair">

			<h2>Kijavítás esetén töltendő ki!</h2>

			<!-- 1/4 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td class="multiline">Kijavítás módja:</td>
					</tr>
					<tr>
						<td >Termék visszaadásának időpontja:</td>
					</tr>
				</table>
			</div>

			<!-- 2/4 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td class="multiline">Kijavítás módja:</td>
					</tr>
					<tr>
						<td >Termék visszaadásának időpontja:</td>
					</tr>
				</table>
			</div>

						<!-- 3/4 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td class="multiline">Kijavítás módja:</td>
					</tr>
					<tr>
						<td>Termék visszaadásának időpontja:</td>
					</tr>
				</table>
			</div>

			<!-- 4/4 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td class="multiline">Kijavítás módja:</td>
					</tr>
					<tr>
						<td>Termék visszaadásának időpontja:</td>
					</tr>
				</table>
			</div>

		</div>

		<div class="in-case-of-replace">

			<h2>Csere esetén töltendő ki!</h2>

			<!-- 1/2 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td>Termék kicserélésének időpontja:</td>
					</tr>
				</table>
			</div>

			<!-- 2/2 -->
			<div class="repair-form">
				<table>
					<tr>
						<td>A jótállási igény bejelentésének időpontja:</td>
					</tr>
					<tr>
						<td>Kijavításra átvétel időpontja:</td>
					</tr>
					<tr>
						<td class="multiline">Hiba oka:</td>
					</tr>
					<tr>
						<td>Termék kicserélésének időpontja:</td>
					</tr>
				</table>
			</div>

		</div>
	
		<div class="text-blck">
		<h2>A vásárlónak hol és mikor kell bejelentenie a jótálláson alapuló igényét?</h2>
		<p>A vásárlónak a jótálláson alapuló igénye érvényesítésével kapcsolatos nyilatkozatát a vásárlás helyén a kereskedőnek, vagy a szerviz átvevő pontnak kell bejelentenie. A vásárló köteles a hibát annak felfedezése után haladéktalanul bejelenteni.</p>

		<div class="service-locations">
			<p>Szerviz átvevő pontok:</p>
			<div class="service-location">
				<p>FOTOPLUS Kft.</p>
				<p>1117 Budapest, Nádorliget u. 7/B</p>
				<p>+36 1 222 4355</p>
				<p>budapest@fotoplus.hu</p>
			</div>

			<div class="service-location">
				<p>FOTOPLUS Kft.</p>
				<p>7622 Pécs, Bajcsy-Zs. u. 7.</p>
				<p>+36 72 216 743</p>
				<p>centrum@fotoplus.hu</p>
			</div>

		</div>

	</div>
	<!-- Jótállás sablon (vége) -->

	<script>
		/* =======================================================================
		JÓTÁLLÁSI OLDALAK GENERÁLÁSA (ES5)
		- Jogszabály szerinti idő figyelembevétele (HUF ár esetén)
		- Ezres tagolás szóközzel
		- Csomagkezelés és gyáriszám-kiosztás
		======================================================================= */



		(function () {
			/* -----------------------------
			DOM referenciák és JSON beolvasás
			----------------------------- */

			/** @type {HTMLElement} items JSON <script> tagja */
			var src      = document.getElementById('items-json');
			/** @type {HTMLElement} ide kerülnek a példány-oldalak */
			var listWrap = document.getElementById('products');
			/** @type {HTMLElement} rejtett sablon, ezt klónozzuk */
			var tpl      = document.getElementById('warranty-template');
			if (!src || !listWrap || !tpl) { return; }


			/**
			 * Biztonságosan kinyeri a node szöveges tartalmát.
			 * PDF/HTML környezetben az innerText és textContent eltérhet, ezért fallback-el.
			 *
			 * @param {Node|null} node - Forrás DOM csomópont.
			 * @returns {string} A csomópontból kinyert szöveg, vagy üres string.
			 */
			function getText(node) { return node ? (node.textContent || node.innerText || '') : ''; }

			/** items tömb beolvasása (védett JSON.parse) */
			var raw = getText(src), items = [];
			try { items = raw ? JSON.parse(raw) : []; } catch (e) { items = []; }

			/* -----------------------------
			PÉNZNEMKEZELÉS
			----------------------------- */

			/** @type {string} Pénznem ISO kód (pl. "HUF") – az ORDER-ből */
			var ORDER_CURRENCY = "{{ order.currency|default_if_none:'' }}";
			/** @type {string} Pénznem szimbólum minta a Django _penz filterből (pl. "0 Ft") */
			var CURRENCY_SAMPLE = "{{ 0|_penz:order.currency|escapejs }}";

			/**
			 * Kinyeri a _penz filter által adott mintából a pénznem szimbólumát.
			 * Elvárt forma: "[szám][space][szimbólum]" (pl. "0 Ft", "0 €").
			 * NBSP (U+00A0) → space konverzió után az utolsó token a szimbólum, ha nem szám.
			 *
			 * @param {string} sample - A minta, pl. "0 Ft".
			 * @returns {string} A szimbólum (pl. "Ft"), vagy üres string, ha nem detektálható.
			 */
			function extractCurrencySymbol(sample) {
				if (!sample) return '';
				var s = String(sample).replace(/\u00A0/g, ' ').trim();
				var parts = s.split(' ');
				var last = parts[parts.length - 1] || '';
				if (/^[0-9.,]+$/.test(last)) return '';
				return last;
			}
			/** @type {string} A detektált pénznem szimbólum (pl. "Ft") */
			var CURRENCY_SYMBOL = extractCurrencySymbol(CURRENCY_SAMPLE);

			/**
			 * @typedef {Object} MoneyRules
			 * @property {boolean} convert_all
			 * @property {Object<string, boolean>} convert_only
			 */
			/** @type {MoneyRules} */
			var MONEY_RULES = { convert_all: false, convert_only: { HUF: true } };

			/**
			 * Eldönti, hogy az adott ISO kódhoz szimbólumot (pl. "Ft"), vagy ISO kódot (pl. "EUR") használjunk.
			 *
			 * @param {string} iso - ISO pénznem kód (pl. "HUF").
			 * @returns {boolean} true, ha szimbólumot kell használni; különben false.
			 */
			function shouldUseSymbol(iso) {
				if (!iso) return false;
				if (MONEY_RULES.convert_all) return true;
				return !!(MONEY_RULES.convert_only && MONEY_RULES.convert_only[iso]);
			}

			/**
			 * Ezres tagolást végez szóközzel az egészrészen; megőrzi a tizedesrészt (pont vagy vessző).
			 * Nem lokalizál, csak „szépíti” a megjelenítést.
			 *
			 * @param {string|number} value - Az eredeti érték.
			 * @returns {string} A tagolt érték (pl. "1 234 567,89"), vagy üres string.
			 */
			function groupThousandsWithSpace(value) {
				if (value === null || typeof value === 'undefined') return '';
				var s = String(value).replace(/\u00A0/g, ' ').trim();

				// Az UTOLSÓ pont vagy vessző legyen a tizedes elválasztó:
				var lastDot   = s.lastIndexOf('.');
				var lastComma = s.lastIndexOf(',');
				var decSep = '';
				if (lastDot > -1 || lastComma > -1) {
					decSep = (lastComma > lastDot) ? ',' : (lastDot > lastComma ? '.' : '');
				}

				var intPart = s, fracPart = '';
				if (decSep) {
					var idx = s.lastIndexOf(decSep);
					intPart = s.slice(0, idx);
					fracPart = s.slice(idx + 1);
				}

				var sign = '';
				if (intPart[0] === '-') { sign = '-'; intPart = intPart.slice(1); }

				// Csak számjegyek maradjanak az egészrészben:
				intPart = intPart.replace(/[^0-9]/g, '');

				// Ezres tagolás:
				var grouped = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');

				return sign + grouped + (decSep ? (decSep + fracPart) : '');
			}

			/**
			 * Összeg + pénznem formázása.
			 * - HUF esetén a _penz mintából nyert szimbólumot (pl. "Ft") használjuk,
			 *   egyébként az ISO kódot (pl. "EUR").
			 * - Az összeg ezres tagolása a groupThousandsWithSpace függvénnyel történik.
			 *
			 * @param {string|number} value - Az összeg (sztringként is érkezhet).
			 * @param {string} [iso] - ISO kód; ha nincs megadva, az ORDER_CURRENCY-t használjuk.
			 * @returns {string} Pl. "12 345 Ft" vagy "12 345 EUR"; üres, ha nincs érték.
			 */
			function formatMoney(value, iso) {
				var code = iso || ORDER_CURRENCY || '';
				if (value === null || typeof value === 'undefined' || value === '') return '';
				var amountStr = groupThousandsWithSpace(value);
				if (!amountStr) return '';
				var label = (shouldUseSymbol(code) && CURRENCY_SYMBOL) ? CURRENCY_SYMBOL : code;
				return amountStr + ' ' + label;
			}

			/* -----------------------------
			ORDER beolvasása + gyáriszám mapek
			----------------------------- */

			/** @type {HTMLElement} ORDER JSON <script> tagja */
			var srcOrder = document.getElementById('order-json');
			/** @type {Object} ORDER objektum */
			var rawOrder = getText(srcOrder), order = {};
			try { order = rawOrder ? JSON.parse(rawOrder) : {}; } catch (e) { order = {}; }

			/**
			 * @typedef {Object} SerialMaps
			 * @property {Object<string, string[]>} pool
			 * @property {Object<string, string>}  byNumber
			 */
			/**
			 * ORDER alapján két gyors-keresésű struktúrát épít:
			 * - pool: SKU → [gyáriszám, ...] FIFO jellegű (queue)
			 * - byNumber: gyáriszám → SKU visszakereséshez
			 *
			 * @param {Object} ord - ORDER objektum (benne: product_number_relationship_list).
			 * @returns {SerialMaps}
			 */
			function buildSerialMapsFromOrder(ord) {
				var pool = {}, byNumber = {};
				var arr = (ord && ord.product_number_relationship_list) || [];
				for (var i = 0; i < arr.length; i++) {
					var r = arr[i] || {};
					var sku = r.product_sku, num = r.number;
					if (!sku || !num) continue;
					var q = Number(r.quantity); if (!isFinite(q) || q <= 0) q = 1;
					if (!pool[sku]) pool[sku] = [];
					for (var j = 0; j < q; j++) pool[sku].push(String(num));
					byNumber[String(num)] = sku;
				}
				return { pool: pool, byNumber: byNumber };
			}
			/** @type {SerialMaps} */
			var maps = buildSerialMapsFromOrder(order);
			/** @type {Object<string,string[]>} SKU -> elérhető gyáriszámok */
			var orderSerialPool   = maps.pool;
			/** @type {Object<string,string>} gyáriszám -> SKU */
			var serialSkuByNumber = maps.byNumber;

			/* -----------------------------
			Általános segédek
			----------------------------- */

			/**
			 * Ürességvizsgálat általános típusokra.
			 *
			 * @param {*} v - Vizsgálandó érték.
			 * @returns {boolean} true, ha üres/hiányzó; különben false.
			 */
			function isEmpty(v) {
				if (v === null || v === undefined) return true;
				if (typeof v === 'string') return v.trim() === '';
				if (Object.prototype.toString.call(v) === '[object Array]') return v.length === 0;
				return false;
			}

			/**
			 * Hozzáad egy (címke, érték) sort a megadott szülő elemhez:
			 * <div class="row"><span class="label">Címke: </span><span class="value">Érték</span></div>
			 *
			 * @param {HTMLElement} parent - Szülő elem, ahová a sort illesztjük.
			 * @param {string} label - Címke (bal oldal).
			 * @param {string|number} value - Megjelenítendő érték (jobb oldal).
			 */
			function addRow(parent, label, value) {
				var row = document.createElement('div'); row.className = 'row';
				var lab = document.createElement('span'); lab.className = 'label';
				lab.appendChild(document.createTextNode(label + ': '));
				var val = document.createElement('span'); val.className = 'value';
				val.appendChild(document.createTextNode(String(value)));
				row.appendChild(lab); row.appendChild(val); parent.appendChild(row);
			}

			/**
			 * Feltételes sor-hozzáadás: csak akkor ír, ha a value nem üres.
			 *
			 * @param {HTMLElement} parent - Szülő elem.
			 * @param {string} label - Címke.
			 * @param {*} value - Érték; ha "üres", nem írunk sort.
			 */
			function addRowIf(parent, label, value) { if (!isEmpty(value)) addRow(parent, label, value); }

			/**
			 * Mennyiség normalizálása:
			 * - NaN, ≤0 → 1
			 * - tört érték → 1
			 * - egyébként az egész érték.
			 *
			 * @param {number|string} q - Bemeneti mennyiség.
			 * @returns {number} Egész, legalább 1.
			 */
			function intQty(q) {
				var n = Number(q);
				if (!isFinite(n) || n <= 0) return 1;
				return Math.floor(n) === n ? n : 1;
			}

			/* -----------------------------
			Jótállás (label + számítás)
			----------------------------- */

			/**
			 * Emberbarát jótállási címkét készít az adott periódus és egység alapján.
			 * Felismeri: nap(1), hét(7), hónap(30), év(365); ismeretlen egységnél a*b nap.
			 *
			 * @param {number|string} period - Periódus (darabszám).
			 * @param {number|string} unit - Egység (nap=1, hét=7, hónap=30, év=365).
			 * @returns {string} Pl. "2 év", "6 hónap", "30 nap", vagy üres, ha nem értelmezhető.
			 */
			function warrantyLabel(period, unit) {
				var a = Number(period), b = Number(unit);
				if (!isFinite(a) || !isFinite(b) || a <= 0 || b <= 0) return '';
				var unitName = (b === 1 ? 'nap' : (b === 7 ? 'hét' : (b === 30 ? 'hónap' : (b === 365 ? 'év' : ''))));
				return unitName ? (a + ' ' + unitName) : ((a * b) + ' nap');
			}

			/**
			 * Visszaadja a termékre beállított jótállási időt napokban.
			 * Ha nincs érvényes adat, 0-t ad vissza.
			 *
			 * @param {Object} prod - A termék objektum, jótállási mezőkkel.
			 * @returns {number} A jótállási idő napokban, vagy 0 ha nincs megadva.
			 */
			function warrantyDaysFromProd(prod) {
				var a = Number(prod && prod.warranty_period);
				var b = Number(prod && prod.warranty_period_unit);
				if (!isFinite(a) || !isFinite(b) || a <= 0 || b <= 0) return 0;
				return a * b;
			}

			/**
			 * Napokból emberbarát címkét készít (év/hónap/nap preferencia sorrendben).
			 *
			 * @param {number} days - Napok száma.
			 * @returns {string} Pl. "3 év", "2 hónap", "45 nap" vagy üres, ha 0/érvénytelen.
			 */
			function daysToDisplayLabel(days) {
				var d = Number(days);
				if (!isFinite(d) || d <= 0) return '';
				if (d % 365 === 0) return (d / 365) + ' év';
				if (d % 30  === 0) return (d / 30)  + ' hónap';
				return d + ' nap';
			}

			/**
			 * Jogszabály szerinti jótállás napokban a vételár alapján (csak HUF esetén).
			 * - 10 000 Ft ≤ ár < 250 000 Ft  → 2 év
			 * - 250 000 Ft ≤ ár              → 3 év
			 * - egyéb (vagy nem HUF)         → 0
			 *
			 * @param {number|string} price - Bruttó ár.
			 * @param {string} iso - ISO pénznem kód (csak "HUF" esetén érvényes).
			 * @returns {number} Napok száma (0, ha nem alkalmazható).
			 */
			function statutoryDaysForPrice(price, iso) {
				if (String(iso || '').toUpperCase() !== 'HUF') return 0;
				var p = Number(price);
				if (!isFinite(p) || p <= 0) return 0;
				if (p >= 250000) return 3 * 365;
				if (p >= 10000)  return 2 * 365;
				return 0;
			}

			/**
			 * Fő tétel effektív jótállási címkéje:
			 * max( beállított napok, jogszabály szerinti napok az ITEM ár alapján ).
			 *
			 * @param {Object} prod - Termék objektum (beállított jótállás).
			 * @param {number|string} grossPrice - Tétel bruttó ára.
			 * @param {string} iso - ISO pénznem kód.
			 * @returns {string} Emberbarát címke (pl. "3 év") vagy üres.
			 */
			function effectiveWarrantyLabelForItem(prod, grossPrice, iso) {
				var conf = warrantyDaysFromProd(prod);
				var stat = statutoryDaysForPrice(grossPrice, iso);
				return daysToDisplayLabel(Math.max(conf, stat));
			}

			/**
			 * Csomag-összetevő effektív jótállási címkéje:
			 * max( beállított napok, jogszabály szerinti napok a CSOMAG ÁRA alapján ).
			 *
			 * @param {Object} compProd - Összetevő termék objektum.
			 * @param {number|string} bundleGrossPrice - A csomag teljes bruttó ára.
			 * @param {string} iso - ISO pénznem kód.
			 * @returns {string} Emberbarát címke (pl. "2 év") vagy üres.
			 */
			function effectiveWarrantyLabelForComponent(compProd, bundleGrossPrice, iso) {
				var conf = warrantyDaysFromProd(compProd);
				var stat = statutoryDaysForPrice(bundleGrossPrice, iso);
				return daysToDisplayLabel(Math.max(conf, stat));
			}

			/* -----------------------------
			Renderelési feltételek
			----------------------------- */

			/**
			 * Van-e a terméken érvényes (beállított) jótállási adat?
			 *
			 * @param {Object} prod - Termék objektum.
			 * @returns {boolean} true, ha >0 nap; különben false.
			 */
			function hasWarrantyData(prod) { return warrantyDaysFromProd(prod) > 0; }

			/**
			 * Bármely csomagkomponens rendelkezik-e érvényes jótállással?
			 *
			 * @param {Array<Object>} bundleElements - Csomag-elemek listája.
			 * @returns {boolean} true, ha bármelynek >0 nap; különben false.
			 */
			function anyComponentHasWarranty(bundleElements) {
				if (!bundleElements || !bundleElements.length) return false;
				for (var i = 0; i < bundleElements.length; i++) {
					var p = (bundleElements[i] && bundleElements[i].product) || {};
					if (hasWarrantyData(p)) return true;
				}
				return false;
			}

			/**
			 * Van-e a tételen bármilyen gyáriszám?
			 *
			 * @param {Object} item - Tétel objektum (product_number_relationship_list mezővel).
			 * @returns {boolean} true, ha legalább egy serial van; különben false.
			 */
			function itemHasAnySerial(item) {
				var arr = expandSerials(item && item.product_number_relationship_list);
				return arr.length > 0;
			}

			/* -----------------------------
			Gyáriszám lista segédek
			----------------------------- */

			/**
			 * Gyáriszám-lista kibontása (quantity szerint): {number:'A', quantity:2} → ['A','A'].
			 *
			 * @param {Array<{number:string, quantity:number}>} list - Serial elemek listája.
			 * @returns {string[]} Kinyert gyáriszámok.
			 */
			function expandSerials(list) {
				var out = [];
				if (!list || !list.length) return out;
				for (var i = 0; i < list.length; i++) {
					var e = list[i] || {};
					var num = e.number;
					if (!num) continue;
					var q = Number(e.quantity); if (!isFinite(q) || q <= 0) q = 1;
					for (var j = 0; j < q; j++) out.push(String(num));
				}
				return out;
			}

			/**
			 * Gyáriszámok példányokra osztása.
			 * - qty=1: az összes serial egy sorban
			 * - s.length==qty: egy-egy
			 * - s.length<qty: ami jut, a többi üres
			 * - s.length>qty és qty>1: az utolsó kapja a maradékot
			 *
			 * @param {number} qty - Példányszám.
			 * @param {string[]} serials - Elérhető gyáriszámok.
			 * @returns {string[]} Példányonkénti sorok.
			 */
			function assignSerials(qty, serials) {
				var n = qty > 0 ? qty : 1;
				var result = []; for (var i = 0; i < n; i++) result.push('');
				var s = serials || [];
				if (n === 1) { result[0] = s.length ? s.join(', ') : ''; return result; }
				if (s.length === n) { for (i = 0; i < n; i++) result[i] = s[i]; return result; }
				if (s.length < n) { for (i = 0; i < s.length; i++) result[i] = s[i]; return result; }
				for (i = 0; i < n - 1; i++) result[i] = s[i];
				result[n - 1] = [s[n - 1]].concat(s.slice(n)).join(', ');
				return result;
			}

			/* -----------------------------
			Termék mezők kirajzolása
			----------------------------- */

			/**
			 * A termék fő mezőit írja ki; a jótállást opcionálisan felül lehet írni
			 * egy előre kiszámolt címkével (effektív jótállás).
			 *
			 * @param {HTMLElement} parent - A cél DOM elem.
			 * @param {Object} prod - Termék objektum.
			 * @param {string} [warrantyOverrideLabel] - Felülíró jótállási címke (ha megadott).
			 */
			function renderProductCore(parent, prod, warrantyOverrideLabel) {
				addRowIf(parent, 'Termék megnevezése', prod.primary_category_name);
				addRowIf(parent, 'Termék típusa',      prod.display_name);
				addRowIf(parent, 'SKU',                prod.sku);

				var wl = warrantyOverrideLabel || warrantyLabel(prod.warranty_period, prod.warranty_period_unit);
				if (wl) addRow(parent, 'Jótállási idő', wl);

				addRowIf(parent, 'Gyártó',             prod['manufacturer__name']);
				addRowIf(parent, 'Származási ország',  prod.country_of_origin);
			}

			/* -----------------------------
			Gyáriszám pool/queue kezelés
			----------------------------- */

			/**
			 * Egy megadott érték ELSŐ előfordulását eltávolítja a tömbből (in-place).
			 *
			 * @param {Array} arr - Forrás tömb.
			 * @param {*} value - Eltávolítandó érték.
			 */
			function removeOne(arr, value) {
				if (!arr || !arr.length) return;
				for (var i = 0; i < arr.length; i++) { if (arr[i] === value) { arr.splice(i, 1); return; } }
			}

			/**
			 * Nem csomag tételek gyáriszámait levonja az ORDER poolból,
			 * hogy a csomag komponensek kiosztásánál már csak a maradék maradjon.
			 *
			 * @param {Array<Object>} items - Rendelés tételei.
			 * @param {Object<string,string[]>} pool - SKU → gyáriszámok (globális készlet).
			 */
			function consumeStandaloneSerials(items, pool) {
				for (var i = 0; i < items.length; i++) {
					var it = items[i] || {};
					var isBundle = it.bundle_elements && it.bundle_elements.length;
					if (isBundle) continue;
					var prod = it.product || {};
					var sku  = prod && prod.sku;
					if (!sku) continue;
					var serials = expandSerials(it.product_number_relationship_list || []);
					for (var j = 0; j < serials.length; j++) {
						removeOne(pool[sku] || [], serials[j]);
					}
				}
			}

			/**
			 * Egy tétel saját gyáriszám- listájából per-SKU lokális sorokat (queue-kat) képez.
			 * A serial→SKU megfeleltetéshez az ORDER byNumber mapet használja.
			 *
			 * @param {string[]} serials - A tételhez tartozó gyáriszámok.
			 * @param {Object<string,string>} serialByNumber - Gyáriszám→SKU map.
			 * @param {string} [fallbackSku] - Használandó SKU, ha nincs találat az ORDER-ben.
			 * @returns {Object<string,string[]>} SKU → lokális serial-queue.
			 */
			function buildQueuesFromItemSerials(serials, serialByNumber, fallbackSku) {
				var m = {};
				for (var i = 0; i < serials.length; i++) {
					var num = serials[i];
					var sku = serialByNumber[num] || fallbackSku || '';
					if (!sku) continue;
					if (!m[sku]) m[sku] = [];
					m[sku].push(num);
				}
				return m;
			}

			/**
			 * Kioszt EGY gyáriszámot egy SKU-hoz: először a lokális queue-ból, ha nincs, az ORDER poolból.
			 * A kiválasztott értéket a poolból is eltávolítja a duplikáció elkerülésére.
			 *
			 * @param {string} sku - Cél SKU.
			 * @param {Object<string,string[]>} localQueues - Lokális queue-k (tétel-szint).
			 * @param {Object<string,string[]>} pool - Globális pool (ORDER).
			 * @returns {string} A kiosztott gyáriszám, vagy üres string.
			 */
			function allocOneForSku(sku, localQueues, pool) {
				if (sku && localQueues && localQueues[sku] && localQueues[sku].length) {
					var v = localQueues[sku].shift();
					removeOne(pool[sku] || [], v);
					return v;
				}
				if (sku && pool[sku] && pool[sku].length) {
					return pool[sku].shift();
				}
				return '';
			}

			/**
			 * Ellenőrzi, hogy elérhető-e legalább egy gyáriszám az adott SKU-hoz
			 * (vagy a lokális queue-ban, vagy a globális poolban).
			 *
			 * @param {string} sku - Vizsgált SKU.
			 * @param {Object<string,string[]>} localQueues - Lokális queue-k.
			 * @param {Object<string,string[]>} pool - Globális pool.
			 * @returns {boolean} true, ha van serial; különben false.
			 */
			function hasAvailableSerialForSku(sku, localQueues, pool) {
				if (!sku) return false;
				if (localQueues && localQueues[sku] && localQueues[sku].length) return true;
				if (pool && pool[sku] && pool[sku].length) return true;
				return false;
			}

			/* -----------------------------
			Csomag komponensek renderelése
			----------------------------- */

			/**
			 * Csomag összetevők kirajzolása.
			 * - Csak azok az összetevők kerülnek ki, amelyeknek van beállított jótállása VAGY
			 *   elérhető hozzájuk legalább egy gyáriszám.
			 * - Összetevőnként/példányonként kioszt egy gyáriszámot (ha van).
			 * - Az összetevő effektív jótállását a CSOMAG ÁRA alapján is értékeli.
			 *
			 * @param {HTMLElement} parent - A szülő elem (fő tétel blokkja).
			 * @param {Array<Object>} bundleElements - Csomag-összetevők.
			 * @param {Object<string,string[]>} localQueues - Lokális serial-queue-k (tétel).
			 * @param {Object<string,string[]>} pool - ORDER pool (globális).
			 * @param {number|string} bundleGrossPrice - A csomag bruttó ára (jogszabályi vizsgálathoz).
			 */
			function renderComponents(parent, bundleElements, localQueues, pool, bundleGrossPrice) {
				if (!bundleElements || !bundleElements.length) return;

				var wrap  = document.createElement('div'); wrap.className = 'components';
				var title = document.createElement('div'); title.className = 'row';
				title.innerHTML = '<strong>Csomag összetevők</strong>';
				wrap.appendChild(title);

				for (var i = 0; i < bundleElements.length; i++) {
					var be = bundleElements[i] || {};
					var p  = be.product || {};
					var count = intQty(be.quantity);
					var sku   = p && p.sku;

					// Csak akkor, ha van jótállás VAGY van legalább egy serial
					if (!hasWarrantyData(p) && !hasAvailableSerialForSku(sku, localQueues, pool)) {
						continue;
					}

					// Effektív jótállás (összetevő): max(beállított, jogszabály a CSOMAG ÁRA alapján)
					var effLabel = effectiveWarrantyLabelForComponent(p, bundleGrossPrice, ORDER_CURRENCY);

					for (var r = 0; r < count; r++) {
						var comp = document.createElement('div'); comp.className = 'component';
						addRow(comp, 'Összetevő példány', (r + 1) + ' / ' + count);
						renderProductCore(comp, p, effLabel);

						// Serial kiosztás (ha van)
						if (sku) {
							var s = allocOneForSku(sku, localQueues, pool);
							addRowIf(comp, 'Gyáriszám(ok)', s);
						}
						wrap.appendChild(comp);
					}
				}

				// Ha csak a cím maradt (nincs tényleges komponens), ne tegyük ki
				if (wrap.children.length > 1) parent.appendChild(wrap);
			}

			/* -----------------------------
			Előkészítés
			----------------------------- */

			// Nem csomag tételek gyáriszámait levonjuk a globális poolból
			consumeStandaloneSerials(items, orderSerialPool);

			/* -----------------------------
			Oldalak generálása
			----------------------------- */
			for (var i = 0; i < items.length; i++) {
				var item     = items[i] || {};
				var prod     = item.product || {};
				var qty      = intQty(item.quantity);
				var isBundle = item.bundle_elements && item.bundle_elements.length;

				// Döntés: legyen-e oldal?
				// 1) van beállított jótállás VAGY
				// 2) bármely komponensnek van jótállása VAGY
				// 3) van bármilyen gyáriszám a tételen
				var renderMainHasWarranty    = hasWarrantyData(prod);
				var renderHasAnyCompWarranty = anyComponentHasWarranty(item.bundle_elements);
				var renderHasSerials         = itemHasAnySerial(item);
				if (!renderMainHasWarranty && !renderHasAnyCompWarranty && !renderHasSerials) {
					continue;
				}

				// item saját serialok
				var serialList     = expandSerials(item.product_number_relationship_list || []);
				var perPageSerials = isBundle ? [] : assignSerials(qty, serialList);

				// bundle lokális queue-k (ha kell)
				var bundleSkuQueues = null;
				if (isBundle) {
					var fallback = (prod && prod.sku) || '';
					bundleSkuQueues = buildQueuesFromItemSerials(serialList, serialSkuByNumber, fallback);
				}

				// Fő tétel effektív jótállása: max(beállított, jogszabály az ITEM ár alapján)
				var mainEffLabel = effectiveWarrantyLabelForItem(prod, item.gross_price, ORDER_CURRENCY);

				// Példányonként 1 oldal
				for (var k = 0; k < qty; k++) {
					var page = tpl.cloneNode(true);
					page.removeAttribute('id');
					page.style.display = '';

					var slot = page.getElementsByClassName('product-slot')[0];
					if (slot) {
						addRow(slot, 'Példány', (k + 1) + ' / ' + qty);

						// Fő termék adatai + effektív jótállás
						renderProductCore(slot, prod, mainEffLabel);

						// Gyáriszám(ok) – csak nem csomagnál
						if (!isBundle) {
							var serialText = perPageSerials[k] || '';
							addRowIf(slot, 'Gyáriszám(ok)', serialText);
						}

						// Megjegyzés + Vételár (összeg ezres tagolással, pénznem szabály szerint)
						addRowIf(slot, 'További (azonosító) adat(ok)', item.comment);
						addRowIf(slot, 'Vételár', formatMoney(item.gross_price, ORDER_CURRENCY));

						// Csomag komponensek (effektív jótállás a CSOMAG ÁRA szerint)
						if (isBundle) {
							renderComponents(slot, item.bundle_elements, bundleSkuQueues, orderSerialPool, item.gross_price);
						}
					}
					listWrap.appendChild(page);
				}
			}
		})(); // IIFE vége
	</script>

{% else %}

	nincs adat

{% endif %}